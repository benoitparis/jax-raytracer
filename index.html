
<html lang="en">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0"> </script>
    <title>JAX Raytracer</title>
  </head>
  <body>
    <h4>JAX Raytracer</h4><hr/>
    <canvas id="jax-raytracer"></canvas>
    <h4>Demo</h4><hr/>


    <script type="text/javascript">
      let model;
      let canvas;
      async function setup() {
        tf.setBackend('cpu'); // OK
        // tf.setBackend('webgl'); // KO
        // tf.env().set('WEBGL_USE_SHAPES_UNIFORMS', true);
        // tf.env().set('WEBGL_USE_SHAPES_UNIFORMS', false);
        // tf.env().set('WEBGL_PACK', false);
        // tf.env().set('WEBGL_CONV_IM2COL', false);
        model = await tf.loadGraphModel('/model.json');
        console.log(tf.getBackend());
        console.log(tf.env());
        console.log(model);
        canvas = document.getElementById("jax-raytracer");

      }

      const start = Date.now()
      async function getOutput() {

        let time = ((Date.now()-start) / 1000);
        // console.log(time);
        const x = tf.tensor([time], [1]);
        // const x = tf.tensor([1.0], [1]);
        // console.log(x);
        // console.log(x.dataSync());
        let result = model.predict(x);
        // console.log(result.shape);
        // console.log(result);
        // console.log(result.dataSync());
        console.log(tf.memory());

        await tf.browser.toPixels(result, canvas);
        // tf.dispose(x);
        // tf.dispose(result);
        requestAnimationFrame(getOutput)

      }
      setup().then(getOutput);


    </script>

    <h4>Pourquoi donc?</h4><hr/>


  </body>
</html>
  